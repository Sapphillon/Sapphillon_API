// Copyright 2025 Yuta Takahashi
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//     http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

syntax = "proto3";

package sapphillon.v1;

import "google/protobuf/timestamp.proto";
import "sapphillon/v1/permission.proto";

// Represents a single parameter (argument or return value) of a function.
// Stores the variable name, type, and description similar to JSDoc @param or @returns.
//
// Fields:
// - name: The variable name of the parameter.
// - type: The type of the parameter (e.g., "string", "number", "object").
// - description: A short description of what the parameter represents.
//
// Example:
//   FunctionParameter {
//     name: "userId"
//     type: "string"
//     description: "The unique identifier of the user"
//   }
message FunctionParameter {
  // The variable name of the parameter.
  // Example: "userId", "message", "options".
  string name = 1;

  // The type of the parameter.
  // Example: "string", "number", "boolean", "object", "Array<string>".
  string type = 2;

  // A short description of what the parameter represents.
  string description = 3;
}

// Represents the function definition including JSDoc-style documentation.
// Stores the function parameters and return value information.
//
// Fields:
// - parameters: The list of function parameters (arguments).
// - returns: The return value information.
//
// Example:
//   FunctionDefine {
//     parameters: [
//       { name: "channelId", type: "string", description: "Target channel ID" },
//       { name: "message", type: "string", description: "Message content" }
//     ]
//     returns: [{ name: "result", type: "boolean", description: "True if sent successfully" }]
//   }
message FunctionDefine {
  // The list of function parameters (arguments).
  // Order should match the function signature.
  repeated FunctionParameter parameters = 1;

  // The return value(s) information. Optional: may be empty for void functions.
  // Multiple return values are supported (e.g., for tuple-like returns).
  repeated FunctionParameter returns = 2;
}

// Describes a callable function exposed by a plugin.
// A function declares its purpose, identity, and required permissions for execution.
//
// Fields:
// - function_id: Stable unique identifier used by systems to reference the function.
// - function_name: Human-friendly name suitable for UIs.
// - description: Summary of what the function does and typical use cases.
// - permissions: Permissions required for the caller to execute this function.
// - function_define: JSDoc-style definition with parameters and return value.
//
// Example:
//   PluginFunction {
//     function_id: "send_notification"
//     function_name: "Send Notification"
//     description: "Sends a message to a configured channel"
//     permissions: [{ permission_type: PERMISSION_TYPE_EXECUTE, resource: ["channels/general"] }]
//     function_define: {
//       parameters: [{ name: "channelId", type: "string", description: "Target channel" }]
//       returns: [{ name: "success", type: "boolean", description: "True if sent" }]
//     }
//   }
message PluginFunction {
  // Stable unique identifier for the function.
  // Behavior: Required. Must be unique within the plugin package.
  // Format: Function name only (e.g. "send_notification").
  string function_id = 1;

  // Human-friendly display name of the function.
  // Example: "Send Notification".
  string function_name = 2;

  // Short description of what the function does and when to use it.
  string description = 3;

  // Permissions required to execute this function successfully.
  // Use Permission.resource to scope to specific entities as needed.
  repeated Permission permissions = 4;

  // Reserved for backward compatibility with previous arguments and returns fields.
  reserved 5, 6;
  reserved "arguments", "returns";

  // JSDoc-style function definition with parameters and return value.
  // Contains structured information about function arguments and return type.
  FunctionDefine function_define = 7;

  // Version of the function.
  // Allows for multiple versions of the same function to exist.
  string version = 8;
}

// Represents a plugin package that can be installed into the platform.
// A plugin groups one or more functions and includes metadata useful for discovery and governance.
//
// Fields:
// - package_id: Stable unique identifier of the plugin package.
// - package_name: Human-friendly name of the plugin.
// - package_version: Semantic version string (e.g., "1.2.3").
// - description: Summary of the plugin's purpose and capabilities.
// - functions: Functions exposed by this plugin.
// - plugin_store_url: URL to the plugin page or documentation.
// - internal_plugin: Indicates whether the plugin is internal-only.
// - verified: Indicates whether the plugin is verified by the platform.
//
// - deprecated: Indicates whether the plugin is deprecated and should not be used for new workflows.
// - installed_at: Time when the plugin was installed.
// - updated_at: Time when the plugin was last updated.
//
// Example:
//   PluginPackage {
//     package_id: "com.example.notifications"
//     package_name: "Notifications"
//     package_version: "1.4.0"
//     description: "Provides functions for sending notifications"
//     plugin_store_url: "https://plugins.example.com/com.example.notifications"
//     verified: true
//     functions: [{ function_id: "send_notification", ... }]
//   }
message PluginPackage {
  // Stable unique identifier for the plugin package.
  // Behavior: Required; unique across all installed plugins.
  // Format: Pure package name only (e.g. "sapphillon").
  string package_id = 1;

  // Human-friendly name of the plugin package.
  // Example: "Notifications".
  string package_name = 2;

  // Semantic version of the plugin package.
  // Format: "MAJOR.MINOR.PATCH" (e.g., "1.0.3").
  string package_version = 3;

  // Description of the plugin's purpose and capabilities.
  string description = 4;

  // Functions exposed by this plugin.
  repeated PluginFunction functions = 5;

  // URL to the plugin's store page or documentation.
  // Example: "https://plugins.example.com/com.example.notifications".
  string plugin_store_url = 6;

  // Whether this plugin is intended for internal use only.
  // Behavior: Optional. Defaults to false when unset.
  optional bool internal_plugin = 7;

  // Whether this plugin has been verified by the platform or publisher.
  // Behavior: Optional. Defaults to false when unset.
  optional bool verified = 8;

  // Whether this plugin is deprecated. New usage should be avoided.
  // Behavior: Optional. When true, UIs should display warnings.
  optional bool deprecated = 9;

  // Time when the plugin was installed.
  google.protobuf.Timestamp installed_at = 10;

  // Time when the plugin metadata or package was last updated.
  google.protobuf.Timestamp updated_at = 11;

  // The provider identifier of the plugin.
  // Example: "app.sapphillon".
  string provider_id = 12;
}
